<app-header></app-header>
<div class="container" style="background-color: #f8f9fa; margin: 1rem;">
  <mat-stepper #stepper [linear]="isLinear" [selectedIndex]="selectedIndex">
    <mat-step label="Upload CSV" state="scan">
      <mat-card style="width: 400px;margin: auto;background-color: #f8f9fa;">
        <p class="source-txt">Kindly select the source CSV file</p>
        <div>
          <mat-card *ngIf="file && !file['item']" class="drag-drop-container inner-card m5">
            <div class="drag-drop-inner-container" (click)="fileInput.click()" appDragDrop
              (onFileDropped)="onFileDropped($event)">
              <input hidden type="file" #fileInput (change)="fileInputChange($event)">
              <h3>Drag and drop file here</h3>
              <img class="sty" src="../../assets/cloud-upload.png" width="50" height="50">
              <h3>or</h3>
              <button mat-raised-button color="primary">Upload CSV</button>
            </div>
          </mat-card>
          <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12">
            <mat-card *ngIf="file && file['item']" class="file-container inner-card m5">
              <div class="col-lg-8 col-md-8 col-xs-8 col-sm-8" style="display: flex; align-items: center">
                <span class="fileName"> {{ file['item'].name }} </span>
              </div>

              <div class="col-lg-4 col-md-4 col-xs-4 col-sm-4 file-action-container"
                style="display: flex; justify-content: flex-end">
                <button mat-raised-button *ngIf="file && file['item']" class="apiplatform-btn-2"
                  (click)="scanFile()">
                  Scan
                </button>
                <span class="material-icons" (click)="deleteFile()" style="margin: 0 5px ">
                  delete
                </span>
              </div>
            </mat-card>
          </div>
        </div>


        <!-- <div class="col-12" style="text-align: center;margin-top: 1rem;margin-bottom: 1rem;">
          <button mat-raised-button (click)="uploadFile()">
            Select File
          </button>
          <button mat-raised-button matStepperNext>
            Proceed to Next
          </button>
        </div> -->
      </mat-card>
    </mat-step>
    <!-- <mat-step label="Ready to Import" state="upload">
      <mat-card>
        <p class="source-txt">CSV file has been scanned successfully.</p>
        <div class="col-12" style="text-align: center;margin-top: 1rem;margin-bottom: 1rem;">
          <button mat-raised-button matStepperNext>
            Proceed to Next 
          </button>
        </div>
      </mat-card>
    </mat-step> -->
    <mat-step label="Connect Fresh Service" state="connect">
      <mat-card style="width: 400px;margin: auto;">
        <p class="source-txt">Configure API Key</p>
        <div class="row">
          <mat-form-field appearance="outline">
            <mat-label>Domain</mat-label>
            <input matInput [(ngModel)]="domain">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>API Key</mat-label>
            <input matInput [(ngModel)]="apikey">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Password</mat-label>
            <input matInput [(ngModel)]="password">
          </mat-form-field>
        </div>
        <div class="col-12" style="text-align: center;margin-top: 1rem;margin-bottom: 1rem;">
          <button mat-raised-button style="margin-right: 10px;" color="primary" (click)="connect()">
            <span *ngIf="!isLoading1">Connect </span>
            <span *ngIf="isLoading1">
                <img src="../assets/button_loading.gif" class="img img-responsive button_loading"
                    style="width: 20px;">
            </span>
            
          </button>
          <button mat-raised-button matStepperNext color="primary" [disabled]="isconnected">
            Proceed to Next
          </button>
        </div>
      </mat-card>
    </mat-step>
    <mat-step label="Field Mapping" state="mapping">
      <div class="table-responsive">
        <table class="col-lg-12 col-md-12 col-sm-12">
            <thead>
                <th>Target Field</th>
                <th></th>
                <th>Source Field</th>
                <th>Override</th>
                <th>
                  <mat-icon matTooltip="Add Attribute" (click)="addAttributeField()">add_box</mat-icon>
                    <!-- <i matTooltip="Add Attribute"
                        class="fa fa-plus-square tour-schema-def-add-attribute"
                        (click)="addAttributeFieldToPlan(i)"></i> -->
                </th>
            </thead>
            <tbody>
                <ng-container
                    *ngFor="let attribute of attributes let j = index">
                    <tr class="root">
                        <td
                            class="tour-schema-def-data-type">
                            <input
                                class="form-control attribute"
                                [value]="attribute.targetfield"
                                [(ngModel)]="attribute.targetfield">

                        </td>
                       
                        <td class="text-center">
                            <mat-icon>arrow_right_alt</mat-icon>
                        </td>
                        <td
                            class="tour-schema-def-data-type">
                            
                            <input class="form-control"
                                [(ngModel)]="attribute.sourcefield"
                                type="text">
                        </td>
                        <td class="text-center">
                            <mat-checkbox
                                [checked]="attribute.isOverride"
                                (change)="attribute.isOverride = !attribute.isOverride;">
                            </mat-checkbox>
                        </td>
                        
                        <td class="text-center">
                          <mat-icon (click)="removeAttribute(attributes, j)">remove_circle_outline</mat-icon>
                            
                        </td>

                    </tr>
                </ng-container>

            </tbody>
        </table>
    </div>

    </mat-step>
    <mat-step label="Migrate Data" state="data">
      <mat-card>
        <p class="source-txt">Everything is setup to migrate data</p>
        <div class="col-12" style="text-align: center;margin-top: 1rem;margin-bottom: 1rem;">
          <button mat-raised-button>
            Proceed Migration
          </button>
        </div>
      </mat-card>
    </mat-step>

    <ng-template matStepperIcon="upload">
      <mat-icon>publish</mat-icon>
    </ng-template>
    <ng-template matStepperIcon="connect">
      <mat-icon>usb</mat-icon>
    </ng-template>
    <ng-template matStepperIcon="scan">
      <mat-icon>device_hub</mat-icon>
    </ng-template>
    <ng-template matStepperIcon="mapping">
      <mat-icon>list_alt</mat-icon>
    </ng-template>
    <ng-template matStepperIcon="data">
      <mat-icon>send</mat-icon>
    </ng-template>
  </mat-stepper>
</div>